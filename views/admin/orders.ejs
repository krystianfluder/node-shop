<%- include('../includes/head.ejs') %>
</head>

<body>
  <%- include('../includes/navigation.ejs') %>
  <main class="container">
    <%- include('../includes/breadcrumbs-and-header.ejs') %>

    <% if (orders.length <= 0) { %>

      <h1>Nothing there!</h1>      
      
    <% } else { %>
    
    <h2 class="mb-4">Total orders: <%= totalOrders %></h2>
    <ul class="list-group mb-4">
      <% orders.forEach(order => { %>
      <li class="list-group-item">
        <h2 class="mb-4">Id: <%= order._id %></h1>
        <p>Created at: <%= order.createdAt %></p>
        <p>Total price: <%= order.totalPrice/100 %> <%= process.env.CURRENCY %></p>
        <p>Invoice: <a class="btn btn-link" href="/orders/<%= order._id %>">Download</a></p>

        <% order.paid ? order.paid = 'true' : order.paid = 'false' %>
        <p>Paid: <%= order.paid %></p>

        <p>Status: <%= order.status %></p>

        <% if(order.status === "in progress") { %>
        <form action="/admin/order-delivered/<%= order._id %>" method="POST">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <button class="btn btn-primary" type="submit">Click if order delivered</button>
        </form>
        <% } %>

        <h3>Products: </h3>
        <ul class="list-group">
          <% order.products.forEach(p => { %>
          <li class="list-group-item d-flex align-items-center">
            <a class="btn btn-link" href="/products/<%= p.product._id %>"><%= p.product.title %></a>
            <div><%= p.product.price/100 %> â‚¬ * <%= p.quantity %> = <%= (p.product.price/100) * p.quantity %> <%= process.env.CURRENCY %></div>
          </li>
          <% }); %>
        </ul>
        <h3>Profile</h3>
        <P>
          <%= order.profile %>
        </P>
      </li>
      <% }); %>
    </ul>

    <%- include('../includes/pagination.ejs') %>

    <% } %>
  </main>
  <%- include('../includes/end.ejs') %>